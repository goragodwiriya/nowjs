<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Integration - Now.js Examples</title>
  <meta name="description" content="Complete API integration examples with Now.js - HTTP Client, Loading States, Error Handling">

  <!-- Framework CSS -->
  <link rel="stylesheet" href="../../Now/dist/now.core.min.css">
  <link rel="stylesheet" href="../../Now/css/fonts.css">

  <!-- Website CSS -->
  <link href="https://fonts.googleapis.com/css?family=Kodchasan" rel="stylesheet">
  <link rel="stylesheet" href="../../Now/css/syntaxhighlightercomponent.css">
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- Navbar -->
  <header data-component="header"></header>

  <!-- Main Content -->
  <main id="main" role="main">
    <section class="hero center">
      <div class="container">
        <h1 data-i18n>API Integration Examples</h1>
        <p class="text-gradient" data-i18n>Complete examples of HTTP Client usage, Loading States, and Error Handling with Now.js</p>
      </div>
    </section>

    <article class="container content">

      <!-- Example 1: User List with Loading States -->
      <section class="section">
        <h2 data-i18n>Example 1: User List with Loading States</h2>
        <p>ตัวอย่างการดึงข้อมูล users จาก API พร้อม skeleton loading และ error handling</p>

        <div class="controls">
          <button id="loadUsers" class="button primary">Load Users</button>
          <button id="refreshUsers" class="button">Refresh</button>
          <button id="simulateError" class="button danger">Simulate Error</button>
        </div>

        <div id="userListContainer" class="card-grid">
          <!-- User cards will be loaded here -->
        </div>

        <div class="code-section">
          <h3>JavaScript Code:</h3>
          <pre><code data-component="syntaxhighlighter" data-language="javascript">// Load users from API
              async function loadUsers() {
              const container = document.getElementById('userListContainer');

              // Show loading skeleton
              container.innerHTML = createSkeletonCards(6);

              try {
              const response = await fetch('https://jsonplaceholder.typicode.com/users');

              if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
              }

              const users = await response.json();

              // Render user cards
              container.innerHTML = users.map(user => `
              &lt;div class="card"&gt;
              &lt;div class="card-header"&gt;
              &lt;h3&gt;${user.name}&lt;/h3&gt;
              &lt;/div&gt;
              &lt;div class="card-body"&gt;
              &lt;p&gt;&lt;strong&gt;Email:&lt;/strong&gt; ${user.email}&lt;/p&gt;
              &lt;p&gt;&lt;strong&gt;Phone:&lt;/strong&gt; ${user.phone}&lt;/p&gt;
              &lt;p&gt;&lt;strong&gt;Company:&lt;/strong&gt; ${user.company.name}&lt;/p&gt;
              &lt;/div&gt;
              &lt;/div&gt;
              `).join('');

              } catch (error) {
              // Show error state
              container.innerHTML = `
              &lt;div class="error-state"&gt;
              &lt;div class="icon-alert-circle"&gt;&lt;/div&gt;
              &lt;h3&gt;Failed to load users&lt;/h3&gt;
              &lt;p&gt;${error.message}&lt;/p&gt;
              &lt;button onclick="loadUsers()" class="button primary"&gt;Retry&lt;/button&gt;
              &lt;/div&gt;
              `;
              }
              }</code></pre>
        </div>
      </section>

      <!-- Example 2: Weather Widget with Auto-Refresh -->
      <section class="section">
        <h2 data-i18n>Example 2: Weather Widget with Auto-Refresh</h2>
        <p>Real-time weather data พร้อม loading spinner และ auto-refresh ทุก 30 วินาที</p>

        <div class="weather-widget" id="weatherWidget">
          <div class="weather-loading">
            <div class="spinner"></div>
            <p>Loading weather data...</p>
          </div>
        </div>

        <div class="controls">
          <button id="loadWeather" class="button primary">Load Weather</button>
          <button id="toggleAutoRefresh" class="button">Enable Auto-Refresh</button>
        </div>

        <div class="code-section">
          <h3>JavaScript Code:</h3>
          <pre><code data-component="syntaxhighlighter" data-language="javascript">// Weather widget with auto-refresh
              let autoRefreshInterval = null;

              async function loadWeather() {
              const widget = document.getElementById('weatherWidget');

              // Show loading spinner
              widget.innerHTML = `
              &lt;div class="weather-loading"&gt;
              &lt;div class="spinner"&gt;&lt;/div&gt;
              &lt;p&gt;Loading weather data...&lt;/p&gt;
              &lt;/div&gt;
              `;

              try {
              // Using OpenWeatherMap API (requires API key)
              const lat = 13.7563; // Bangkok
              const lon = 100.5018;
              const apiKey = 'demo'; // Replace with your API key

              const response = await fetch(
              `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`
              );

              if (!response.ok) throw new Error('Weather API failed');

              const data = await response.json();

              // Render weather data
              widget.innerHTML = `
              &lt;div class="weather-content"&gt;
              &lt;h3&gt;${data.name}&lt;/h3&gt;
              &lt;div class="weather-temp"&gt;${Math.round(data.main.temp)}°C&lt;/div&gt;
              &lt;p&gt;${data.weather[0].description}&lt;/p&gt;
              &lt;div class="weather-details"&gt;
              &lt;span&gt;Humidity: ${data.main.humidity}%&lt;/span&gt;
              &lt;span&gt;Wind: ${data.wind.speed} m/s&lt;/span&gt;
              &lt;/div&gt;
              &lt;small&gt;Last updated: ${new Date().toLocaleTimeString()}&lt;/small&gt;
              &lt;/div&gt;
              `;

              } catch (error) {
              widget.innerHTML = `
              &lt;div class="error-state"&gt;
              &lt;p&gt;Failed to load weather data&lt;/p&gt;
              &lt;button onclick="loadWeather()" class="button"&gt;Retry&lt;/button&gt;
              &lt;/div&gt;
              `;
              }
              }

              // Toggle auto-refresh
              function toggleAutoRefresh() {
              if (autoRefreshInterval) {
              clearInterval(autoRefreshInterval);
              autoRefreshInterval = null;
              } else {
              autoRefreshInterval = setInterval(loadWeather, 30000);
              }
              }</code></pre>
        </div>
      </section>

      <!-- Example 3: Product Search with Debounce -->
      <section class="section">
        <h2 data-i18n>Example 3: Product Search with Debounce</h2>
        <p>Search products พร้อม debounce และ loading indicator</p>

        <div class="search-container">
          <div class="input-group">
            <input type="text" id="productSearch" class="input" placeholder="Search products...">
            <span class="search-loading" id="searchLoading" style="display: none;">
              <div class="spinner-small"></div>
            </span>
          </div>
        </div>

        <div id="productResults" class="product-grid">
          <p class="text-muted">Type to search products...</p>
        </div>

        <div class="code-section">
          <h3>JavaScript Code:</h3>
          <pre><code data-component="syntaxhighlighter" data-language="javascript">// Debounce function
              function debounce(func, wait) {
              let timeout;
              return function executedFunction(...args) {
              const later = () => {
              clearTimeout(timeout);
              func(...args);
              };
              clearTimeout(timeout);
              timeout = setTimeout(later, wait);
              };
              }

              // Search products
              async function searchProducts(query) {
              const resultsContainer = document.getElementById('productResults');
              const loadingIndicator = document.getElementById('searchLoading');

              if (!query.trim()) {
              resultsContainer.innerHTML = '&lt;p class="text-muted"&gt;Type to search products...&lt;/p&gt;';
              return;
              }

              // Show loading
              loadingIndicator.style.display = 'block';

              try {
              const response = await fetch(
              `https://dummyjson.com/products/search?q=${encodeURIComponent(query)}`
              );

              const data = await response.json();

              // Hide loading
              loadingIndicator.style.display = 'none';

              if (data.products.length === 0) {
              resultsContainer.innerHTML = '&lt;p&gt;No products found&lt;/p&gt;';
              return;
              }

              // Render results
              resultsContainer.innerHTML = data.products.map(product => `
              &lt;div class="product-card"&gt;
              &lt;img src="${product.thumbnail}" alt="${product.title}"&gt;
              &lt;h4&gt;${product.title}&lt;/h4&gt;
              &lt;p class="price"&gt;$${product.price}&lt;/p&gt;
              &lt;p class="rating"&gt;⭐ ${product.rating}&lt;/p&gt;
              &lt;/div&gt;
              `).join('');

              } catch (error) {
              loadingIndicator.style.display = 'none';
              resultsContainer.innerHTML = `&lt;p class="error"&gt;Search failed: ${error.message}&lt;/p&gt;`;
              }
              }
              // Attach debounced search to input
              const debouncedSearch = debounce(searchProducts, 500);
              document.getElementById('productSearch').addEventListener('input', (e) => {
              debouncedSearch(e.target.value);
              });</code></pre>
        </div>
      </section>

      <!-- Example 4: Form Submission with Loading States -->
      <section class="section">
        <h2 data-i18n>Example 4: Form Submission (POST/PUT/DELETE)</h2>
        <p>ตัวอย่างการส่งข้อมูลไปยัง API พร้อม loading state และ success/error feedback</p>

        <div class="form-container">
          <form id="userForm" class="form">
            <div>
              <label for="userName">Name:</label>
              <span class="form-control">
                <input type="text" id="userName" class="input" required>
              </span>
            </div>
            <div>
              <label for="userEmail">Email:</label>
              <span class="form-control">
                <input type="email" id="userEmail" class="input" required>
              </span>
            </div>
            <div>
              <label for="userJob">Job:</label>
              <span class="form-control">
                <input type="text" id="userJob" class="input" required>
              </span>
            </div>
            <div class="form-actions">
              <button type="submit" id="submitBtn" class="button primary">
                <span class="btn-text">Create User</span>
                <span class="btn-loading" style="display: none;">
                  <div class="spinner-small"></div> Creating...
                </span>
              </button>
              <button type="button" id="updateBtn" class="button">Update User</button>
              <button type="button" id="deleteBtn" class="button danger">Delete User</button>
            </div>
          </form>

          <div id="formFeedback" class="feedback-container"></div>
        </div>

        <div class="code-tabs mt-3" data-component="tabs">
          <div class="tab-buttons">
            <button class="tab-button active" data-tab="form-html">HTML</button>
            <button class="tab-button" data-tab="form-post">POST</button>
            <button class="tab-button" data-tab="form-put">PUT</button>
            <button class="tab-button" data-tab="form-delete">DELETE</button>
          </div>
          <div class="tab-content">
            <div class="tab-pane active" data-tab="form-html">
              <pre><code data-component="syntaxhighlighter" data-language="html">
                  &lt;div class="form-container"&gt;
                  &lt;form id="userForm" class="form"&gt;
                  &lt;div&gt;
                  &lt;label for="userName"&gt;Name:&lt;/label&gt;
                  &lt;span class="form-control"&gt;
                  &lt;input type="text" id="userName" class="input" required&gt;
                  &lt;/span&gt;
                  &lt;/div&gt;
                  &lt;div&gt;
                  &lt;label for="userEmail"&gt;Email:&lt;/label&gt;
                  &lt;span class="form-control"&gt;
                  &lt;input type="email" id="userEmail" class="input" required&gt;
                  &lt;/span&gt;
                  &lt;/div&gt;
                  &lt;div&gt;
                  &lt;label for="userJob"&gt;Job:&lt;/label&gt;
                  &lt;span class="form-control"&gt;
                  &lt;input type="text" id="userJob" class="input" required&gt;
                  &lt;/span&gt;
                  &lt;/div&gt;
                  &lt;div class="form-actions"&gt;
                  &lt;button type="submit" id="submitBtn" class="button primary"&gt;
                  &lt;span class="btn-text"&gt;Create User&lt;/span&gt;
                  &lt;span class="btn-loading" style="display: none;"&gt;
                  &lt;div class="spinner-small"&gt;&lt;/div&gt; Creating...
                  &lt;/span&gt;
                  &lt;/button&gt;
                  &lt;button type="button" id="updateBtn" class="button"&gt;Update User&lt;/button&gt;
                  &lt;button type="button" id="deleteBtn" class="button danger"&gt;Delete User&lt;/button&gt;
                  &lt;/div&gt;
                  &lt;/form&gt;

                  &lt;div id="formFeedback" class="feedback-container"&gt;&lt;/div&gt;
                  &lt;/div&gt;
                </code></pre>
            </div>
            <div class="tab-pane" data-tab="form-post">
              <pre><code data-component="syntaxhighlighter" data-language="javascript">
                  // Create user (POST)
                  async function createUser(userData) {
                  const submitBtn = document.getElementById('submitBtn');
                  const btnText = submitBtn.querySelector('.btn-text');
                  const btnLoading = submitBtn.querySelector('.btn-loading');

                  // Show loading state
                  btnText.style.display = 'none';
                  btnLoading.style.display = 'inline-flex';
                  submitBtn.disabled = true;

                  try {
                  const response = await fetch('https://reqres.in/api/users', {
                  method: 'POST',
                  headers: {
                  'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(userData)
                  });

                  if (!response.ok) throw new Error('Failed to create user');

                  const result = await response.json();
                  showFeedback('success', `User created successfully! ID: ${result.id}`);
                  document.getElementById('userForm').reset();

                  } catch (error) {
                  showFeedback('error', `Error: ${error.message}`);
                  } finally {
                  btnText.style.display = 'inline';
                  btnLoading.style.display = 'none';
                  submitBtn.disabled = false;
                  }
                  }
                </code></pre>
            </div>
            <div class="tab-pane" data-tab="form-put">
              <pre><code data-component="syntaxhighlighter" data-language="javascript">
                  // Update user (PUT)
                  async function updateUser(userId, userData) {
                  const updateBtn = document.getElementById('updateBtn');
                  updateBtn.disabled = true;
                  updateBtn.innerHTML = '&lt;div class="spinner-small"&gt;&lt;/div&gt; Updating...';

                  try {
                  const response = await fetch(`https://reqres.in/api/users/${userId}`, {
                  method: 'PUT',
                  headers: {
                  'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(userData)
                  });

                  if (!response.ok) throw new Error('Failed to update user');

                  const result = await response.json();
                  showFeedback('success', 'User updated successfully!');

                  } catch (error) {
                  showFeedback('error', `Error: ${error.message}`);
                  } finally {
                  updateBtn.disabled = false;
                  updateBtn.textContent = 'Update User';
                  }
                  }
                </code></pre>
            </div>
            <div class="tab-pane" data-tab="form-delete">
              <pre><code data-component="syntaxhighlighter" data-language="javascript">
                  // Delete user (DELETE)
                  async function deleteUser(userId) {
                  if (!confirm('Are you sure you want to delete this user?')) return;

                  const deleteBtn = document.getElementById('deleteBtn');
                  deleteBtn.disabled = true;
                  deleteBtn.innerHTML = '&lt;div class="spinner-small"&gt;&lt;/div&gt; Deleting...';

                  try {
                  const response = await fetch(`https://reqres.in/api/users/${userId}`, {
                  method: 'DELETE'
                  });

                  if (!response.ok) throw new Error('Failed to delete user');

                  showFeedback('success', 'User deleted successfully!');
                  document.getElementById('userForm').reset();

                  } catch (error) {
                  showFeedback('error', `Error: ${error.message}`);
                  } finally {
                  deleteBtn.disabled = false;
                  deleteBtn.textContent = 'Delete User';
                  }
                  }
                </code></pre>
            </div>
          </div>
        </div>

        <!-- Example 5: Multiple API Calls with Promise.all -->
        <section class="section">
          <h2 data-i18n>Example 5: Multiple API Calls (Concurrent)</h2>
          <p>เรียก API หลายตัวพร้อมกัน และแสดง loading state แยกกันสำหรับแต่ละ section</p>

          <div class="controls">
            <button id="loadDashboard" class="button primary">Load Dashboard</button>
          </div>

          <div class="dashboard-grid">
            <div class="dashboard-card" id="statsCard">
              <h3>Statistics</h3>
              <div class="loading-placeholder">
                <div class="spinner"></div>
              </div>
            </div>

            <div class="dashboard-card" id="postsCard">
              <h3>Recent Posts</h3>
              <div class="loading-placeholder">
                <div class="spinner"></div>
              </div>
            </div>

            <div class="dashboard-card" id="todosCard">
              <h3>Tasks</h3>
              <div class="loading-placeholder">
                <div class="spinner"></div>
              </div>
            </div>
          </div>

          <div class="code-section">
            <h3>JavaScript Code:</h3>
            <pre><code data-component="syntaxhighlighter" data-language="javascript">// Load multiple APIs concurrently
                async function loadDashboard() {
                try {
                // Show loading state for all cards
                showLoadingState();

                // Fetch all data concurrently
                const [users, posts, todos] = await Promise.all([
                fetch('https://jsonplaceholder.typicode.com/users').then(r => r.json()),
                fetch('https://jsonplaceholder.typicode.com/posts?_limit=5').then(r => r.json()),
                fetch('https://jsonplaceholder.typicode.com/todos?_limit=5').then(r => r.json())
                ]);

                // Render statistics
                document.getElementById('statsCard').innerHTML = `
                &lt;h3&gt;Statistics&lt;/h3&gt;
                &lt;div class="stats"&gt;
                &lt;div class="stat-item"&gt;
                &lt;span class="stat-value"&gt;${users.length}&lt;/span&gt;
                &lt;span class="stat-label"&gt;Total Users&lt;/span&gt;
                &lt;/div&gt;
                &lt;div class="stat-item"&gt;
                &lt;span class="stat-value"&gt;${posts.length}&lt;/span&gt;
                &lt;span class="stat-label"&gt;Recent Posts&lt;/span&gt;
                &lt;/div&gt;
                &lt;/div&gt;
                `;

                // Render posts
                document.getElementById('postsCard').innerHTML = `
                &lt;h3&gt;Recent Posts&lt;/h3&gt;
                &lt;ul class="post-list"&gt;
                ${posts.map(post => `
                &lt;li&gt;&lt;strong&gt;${post.title}&lt;/strong&gt;&lt;/li&gt;
                `).join('')}
                &lt;/ul&gt;
                `;

                // Render todos
                document.getElementById('todosCard').innerHTML = `
                &lt;h3&gt;Tasks&lt;/h3&gt;
                &lt;ul class="todo-list"&gt;
                ${todos.map(todo => `
                &lt;li class="${todo.completed ? 'completed' : ''}"&gt;
                ${todo.title}
                &lt;/li&gt;
                `).join('')}
                &lt;/ul&gt;
                `;

                } catch (error) {
                console.error('Dashboard load failed:', error);
                showErrorState();
                }
                }</code></pre>
          </div>
        </section>

        <!-- Example 6: Error Handling and Retry -->
        <section class="section">
          <h2 data-i18n>Example 6: Advanced Error Handling with Retry</h2>
          <p>Error handling พร้อม retry mechanism และ exponential backoff</p>

          <div class="controls">
            <button id="testRetry" class="button primary">Test Retry Mechanism</button>
          </div>

          <div id="retryLog" class="log-container"></div>

          <div class="code-section">
            <h3>JavaScript Code:</h3>
            <pre><code data-component="syntaxhighlighter" data-language="javascript">
async function fetchWithRetry(url, options = {}, maxRetries = 3) {
  let lastError;

  for (let i = 0; i < maxRetries; i++) {
    try {
      logMessage(`Attempt ${i + 1}/${maxRetries}...`);
      const response = await fetch(url, options);
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      logMessage('✓ Success!', 'success');
      return await response.json();
    } catch (error) {
      lastError = error;
      logMessage(`✗ Failed: ${error.message}`, 'error');
      if (i < maxRetries - 1) {
        const delay = Math.pow(2, i) * 1000;
        logMessage(`Waiting ${delay}ms before retry...`, 'info');
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
  }

  throw new Error(`Failed after ${maxRetries} attempts: ${lastError.message}`);
}

async function testRetry() {
  const logContainer = document.getElementById('retryLog');
  logContainer.innerHTML = '&lt;h4&gt;Retry Log:&lt;/h4&gt;';

  try {
    const data = await fetchWithRetry('https://httpstat.us/500', {}, 3);
  } catch (error) {
    logMessage(`Final error: ${error.message}`, 'error');
  }
}

function logMessage(message, type = 'info') {
  const logContainer = document.getElementById('retryLog');
  const entry = document.createElement('div');
  entry.className = `log-entry log-${type}`;
  entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
  logContainer.appendChild(entry);
}
            </code></pre>
          </div>
        </section>

        <!-- HTTP Client Best Practices -->
        <section class="section">
          <h2>HTTP Client Best Practices</h2>
          <p>แนวทางที่ดีในการใช้งาน HTTP Client</p>

          <div class="best-practices">
            <div class="practice-item">
              <h3>1. Always Handle Errors</h3>
              <pre><code data-component="syntaxhighlighter" data-language="javascript">try {
                  const response = await fetch(url);
                  if (!response.ok) throw new Error(`HTTP ${response.status}`);
                  const data = await response.json();
                  } catch (error) {
                  console.error('Request failed:', error);
                  // Show user-friendly error message
                  }</code></pre>
            </div>

            <div class="practice-item">
              <h3>2. Use Loading States</h3>
              <pre><code data-component="syntaxhighlighter" data-language="javascript">// Show loading before request
                  setLoading(true);

                  try {
                  const data = await fetchData();
                  renderData(data);
                  } finally {
                  // Always hide loading, even if error occurs
                  setLoading(false);
                  }</code></pre>
            </div>

            <div class="practice-item">
              <h3>3. Set Timeouts</h3>
              <pre><code data-component="syntaxhighlighter" data-language="javascript">const controller = new AbortController();
                  const timeoutId = setTimeout(() => controller.abort(), 5000);

                  try {
                  const response = await fetch(url, {
                  signal: controller.signal
                  });
                  clearTimeout(timeoutId);
                  } catch (error) {
                  if (error.name === 'AbortError') {
                  console.log('Request timeout');
                  }
                  }</code></pre>
            </div>

            <div class="practice-item">
              <h3>4. Cache Responses</h3>
              <pre><code data-component="syntaxhighlighter" data-language="javascript">const cache = new Map();

                  async function fetchWithCache(url, ttl = 60000) {
                  const cached = cache.get(url);

                  if (cached && Date.now() - cached.timestamp < ttl) { return cached.data; } const data=await fetch(url).then(r=> r.json());
                    cache.set(url, { data, timestamp: Date.now() });

                    return data;
                    }</code></pre>
            </div>
          </div>
        </section>

    </article>
  </main>

  <!-- Footer -->
  <footer data-component="footer"></footer>

  <!-- Framework Scripts -->
  <script src="../../Now/dist/now.core.min.js"></script>

  <script src="main.js"></script>
</body>

</html>